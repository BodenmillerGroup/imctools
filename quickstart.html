

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart &mdash; imctools  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API reference" href="api_reference.html" />
    <link rel="prev" title="imctools" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> imctools
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-of-version-2-x">Usage of version 2.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-of-version-1-x">Usage of version 1.x</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">imctools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/quickstart.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">imctools</span></code> v2.x has many changes in IMC data output format, available CLI commands, dropped Python 2 and Fiji plugins support, etc.
If you are using <code class="docutils literal notranslate"><span class="pre">imctools</span></code> in pre-processing pipelines, please install v1.x version until your pipeline is modified accordingly!
We strongly encourage you to migrate to <code class="docutils literal notranslate"><span class="pre">imctools</span></code> v2.x as all further efforts will be focused on a development of this version.</p>
</div></blockquote>
<p>An IMC file conversion tool that aims to convert IMC raw data files (.mcd, .txt) into an intermediary ome.tiff, containing all the relevant metadata. Further it contains tools to generate simpler TIFF files that can be directly be used as input files for e.g. CellProfiller, Ilastik, Fiji etc.</p>
<p>For a description of the associated segmentation pipline, please visit: https://github.com/BodenmillerGroup/ImcSegmentationPipeline</p>
<p>Version 2.x documentation: https://bodenmillergroup.github.io/imctools</p>
<p>Version 1.x documentation (deprecated): https://imctools.readthedocs.io</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>MCD lazy data access using memorymaps</p></li>
<li><p>Full MCD metadata access</p></li>
<li><p>TXT file loading</p></li>
<li><p>OME-TIFF loading</p></li>
<li><p>OME-TIFF/TIFF export (including optional compression)</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Supports Python 3.7 or newer</p></li>
<li><p>External dependencies: <code class="docutils literal notranslate"><span class="pre">imagecodecs</span></code>, <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, <code class="docutils literal notranslate"><span class="pre">xmltodict</span></code>, <code class="docutils literal notranslate"><span class="pre">xtiff</span></code>.</p></li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Preferable way to install <code class="docutils literal notranslate"><span class="pre">imctools</span></code> is via official PyPI registry. Please define package version explicitly in order to avoid incompatibilities between v1.x and v2.x versions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">imctools</span><span class="o">==</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">4</span>
</pre></div>
</div>
<p>In old IMC segmentation pipelines versions 1.x should be used!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">imctools</span><span class="o">==</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">8</span>
</pre></div>
</div>
</div>
<div class="section" id="usage-of-version-2-x">
<h2>Usage of version 2.x<a class="headerlink" href="#usage-of-version-2-x" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">imctools</span></code> is often used from Jupyter as part of the pre-processing pipeline, mainly using the <strong>converters</strong> wrapper functions. Please check the <a class="reference external" href="https://github.com/BodenmillerGroup/ImcSegmentationPipeline/blob/development/scripts/imc_preprocessing.ipynb">following example</a> as a template.</p>
<p>Further <code class="docutils literal notranslate"><span class="pre">imctools</span></code> can be directly used as a module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imctools.io.mcd.mcdparser</span> <span class="kn">import</span> <span class="n">McdParser</span>

<span class="n">fn_mcd</span> <span class="o">=</span> <span class="s2">&quot;/home/vitoz/Data/varia/201708_instrument_comp/mcd/20170815_imccomp_zoidberg_conc5_acm1.mcd&quot;</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">McdParser</span><span class="p">(</span><span class="n">fn_mcd</span><span class="p">)</span>

<span class="c1"># Get original metadata in XML format</span>
<span class="n">xml</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_mcd_xml</span><span class="p">()</span>

<span class="c1"># Get parsed session metadata (i.e. session -&gt; slides -&gt; acquisitions -&gt; channels, panoramas data)</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">session</span>

<span class="c1"># Get all acquisition IDs</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">acquisition_ids</span>

<span class="c1"># The common class to represent a single IMC acquisition is AcquisitionData class.</span>
<span class="c1"># Get acquisition data for acquisition with id 2</span>
<span class="n">ac_data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_acquisition_data</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># imc acquisitions can yield the image data by name (tag), label or index</span>
<span class="n">channel_image1</span> <span class="o">=</span> <span class="n">ac_data</span><span class="o">.</span><span class="n">get_image_by_name</span><span class="p">(</span><span class="s1">&#39;Ir191&#39;</span><span class="p">)</span>
<span class="n">channel_image2</span> <span class="o">=</span> <span class="n">ac_data</span><span class="o">.</span><span class="n">get_image_by_label</span><span class="p">(</span><span class="s1">&#39;Histone_phospho_125((2468))Eu153&#39;</span><span class="p">)</span>
<span class="n">channel_image3</span> <span class="o">=</span> <span class="n">ac_data</span><span class="o">.</span><span class="n">get_image_by_index</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># or can be used to save OME-TIFF files</span>
<span class="n">fn_out</span> <span class="o">=</span><span class="s1">&#39;/home/vitoz/temp/test.ome.tiff&#39;</span>
<span class="n">ac_data</span><span class="o">.</span><span class="n">save_ome_tiff</span><span class="p">(</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ir191&#39;</span><span class="p">,</span> <span class="s1">&#39;Yb172&#39;</span><span class="p">])</span>

<span class="c1"># save multiple standard TIFF files in a folder</span>
<span class="n">ac_data</span><span class="o">.</span><span class="n">save_tiffs</span><span class="p">(</span><span class="s2">&quot;/home/anton/tiffs&quot;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bigtiff</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># as the mcd object is using lazy loading memory maps, it needs to be closed</span>
<span class="c1"># or used with a context manager.</span>
<span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="usage-of-version-1-x">
<h2>Usage of version 1.x<a class="headerlink" href="#usage-of-version-1-x" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imctools.io.mcdparser</span> <span class="k">as</span> <span class="nn">mcdparser</span>
<span class="kn">import</span> <span class="nn">imctools.io.txtparser</span> <span class="k">as</span> <span class="nn">txtparser</span>
<span class="kn">import</span> <span class="nn">imctools.io.ometiffparser</span> <span class="k">as</span> <span class="nn">omeparser</span>
<span class="kn">import</span> <span class="nn">imctools.io.mcdxmlparser</span> <span class="k">as</span> <span class="nn">meta</span>

<span class="n">fn_mcd</span> <span class="o">=</span> <span class="s1">&#39;/home/vitoz/Data/varia/201708_instrument_comp/mcd/20170815_imccomp_zoidberg_conc5_acm1.mcd&#39;</span>

<span class="n">mcd</span> <span class="o">=</span> <span class="n">mcdparser</span><span class="o">.</span><span class="n">McdParser</span><span class="p">(</span><span class="n">fn_mcd</span><span class="p">)</span>

<span class="c1"># parsed Metadata Access</span>
<span class="n">mcd</span><span class="o">.</span><span class="n">acquisition_ids</span>
<span class="n">mcd</span><span class="o">.</span><span class="n">get_acquisition_channels</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">mcd</span><span class="o">.</span><span class="n">get_acquisition_description</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

<span class="c1"># a metadata object for comprehensive metadata access</span>
<span class="n">acmeta</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">ACQUISITION</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">acmeta</span><span class="o">.</span><span class="n">properties</span>

<span class="c1"># The common class to represent a single IMC acquisition is</span>
<span class="c1"># The IMC acuqisition class.</span>
<span class="c1"># All parser classes have a &#39;get_imc_acquisition&#39; method</span>
<span class="n">imc_ac</span> <span class="o">=</span> <span class="n">mcd</span><span class="o">.</span><span class="n">get_imc_acquisition</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

<span class="c1"># imc acquisitions can yield the image data</span>
<span class="n">image_matrix</span> <span class="o">=</span> <span class="n">imc_ac</span><span class="o">.</span><span class="n">get_img_by_metal</span><span class="p">(</span><span class="s1">&#39;Ir191&#39;</span><span class="p">)</span>

<span class="c1"># or can be used to save the images using the image writer class</span>
<span class="n">fn_out</span> <span class="o">=</span><span class="s1">&#39;/home/vitoz/temp/test.ome.tiff&#39;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">imc_ac</span><span class="o">.</span><span class="n">get_image_writer</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">fn_out</span><span class="p">,</span> <span class="n">metals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ir191&#39;</span><span class="p">,</span> <span class="s1">&#39;Yb172&#39;</span><span class="p">])</span>
<span class="n">img</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ome&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bigtiff</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># as the mcd object is using lazy loading memory maps, it needs to be closed</span>
<span class="c1"># or used with a context manager.</span>
<span class="n">mcd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="api_reference.html" class="btn btn-neutral float-right" title="API reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="imctools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright University of Zurich, 2021.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>